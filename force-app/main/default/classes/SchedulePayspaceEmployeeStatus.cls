public class SchedulePayspaceEmployeeStatus implements Schedulable {
    public void execute(SchedulableContext sc) {
        try {
            // Query employees to be synced, filter out those already synced (Sync_With_Payspace = TRUE)
            List<flair__Employee__c> employeesToSync = [SELECT Id, flair__Employee_Number__c, flair__Start_Date__c, 
                                                        Status_Created_On_PaySpace__c, Passport_Number__c, flair__Tax_Class__c,
                                                        flair__Type_Of_Occupation__c
                                                        FROM flair__Employee__c 
                                                        WHERE Status_Created_On_PaySpace__c = FALSE AND LastModifiedDate > YESTERDAY
                                                        LIMIT 50
                                                       ];
            
            // Enqueue the Queueable job for each employee
            for (flair__Employee__c employee : employeesToSync) {
                
                Map<String, Object> employeeData = new Map<String, Object> {
                    
                        'EmploymentStatusId' => 0, //This will be auto generated by PaySpace. No need to create this field is Salesforce
                        'GroupJoinDate' => employee.flair__Start_Date__c,
                        'EmploymentDate' => employee.flair__Start_Date__c,
                        'EmployeeNumber' => employee.flair__Employee_Number__c,
                        'IdentityType' => 'Social Security',
                        'PassportNumber' => employee.Passport_Number__c,
                        'TaxStatus' => employee.flair__Tax_Class__c,
                        'NatureOfPerson' => employee.flair__Type_Of_Occupation__c
                                                
                        };
                            
                            // Call Queueable job to send the employee to Payspace
                            System.enqueueJob(new PayspaceEmployeeStatusQueueable(employeeData, employee.Id));
            }
        } catch (Exception e) {
            System.debug('Error while scheduling Payspace sync: ' + e.getMessage());
        }
    }
}